import React, { useState, useEffect } from 'react';
import { Users, BookOpen, GraduationCap, ClipboardList, BarChart3, Settings, LogOut, Home, Menu, X, Calendar, Award, FileText, UserCheck, Plus, Edit, Trash2, Search, ChevronRight, TrendingUp, Bell, Download } from 'lucide-react';

const SmartExamCell = () => {
  const [currentPage, setCurrentPage] = useState('dashboard');
  const [isSidebarOpen, setIsSidebarOpen] = useState(true);
  const [userRole] = useState('admin');
  const [isLoading, setIsLoading] = useState(false);
  const [notification, setNotification] = useState(null);
  
  // State for data
  const [stats, setStats] = useState({
    totalStudents: 0,
    totalCourses: 0,
    totalFaculty: 0,
    upcomingExams: 0
  });
  const [students, setStudents] = useState([]);
  const [courses, setCourses] = useState([]);
  const [faculty, setFaculty] = useState([]);
  const [assessments, setAssessments] = useState([]);
  const [departments, setDepartments] = useState([]);
  const [enrollments, setEnrollments] = useState([]);
  const [searchTerm, setSearchTerm] = useState('');
  const [selectedStudent, setSelectedStudent] = useState(null);
  <!doctype html>
  <html lang="en">
    <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <title>Smart Exam Cell - Mini Dashboard</title>
      <style>
        body { font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background:#f3f4f6; margin:0 }
        .app { max-width:1100px; margin:28px auto; background:white; border-radius:10px; box-shadow:0 6px 20px rgba(0,0,0,0.06); overflow:hidden }
        header { display:flex; align-items:center; justify-content:space-between; padding:20px 24px; background:linear-gradient(90deg,#0ea5e9,#7c3aed); color:white }
        main { padding:20px }
        .stats { display:flex; gap:12px; margin-bottom:16px }
        .stat { flex:1; background:linear-gradient(180deg,#fff,#f8fafc); padding:14px; border-radius:8px; border:1px solid #e6eef6 }
        table { width:100%; border-collapse:collapse; margin-top:12px }
        th,td { text-align:left; padding:8px 10px; border-bottom:1px solid #eef2f7 }
        button { cursor:pointer }
        .nav { display:flex; gap:8px }
        .nav button { background:transparent; border:1px solid rgba(255,255,255,0.2); color:white; padding:6px 10px; border-radius:6px }
        .hidden { display:none }
        .login { padding:24px }
        .login input { padding:8px; width:100%; margin-bottom:8px }
      </style>
      <!-- React, ReactDOM and Babel for in-browser JSX (no build) -->
      <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
      <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
      <script src="https://unpkg.com/babel-standalone@6/babel.min.js" crossorigin></script>
    </head>
    <body>
      <div id="root"></div>

      <script type="text/babel">
        const { useState, useEffect } = React;

        function SmartExamCell() {
          const API = '/api';
          const [page, setPage] = useState('dashboard');
          const [stats, setStats] = useState({ total_students:0, total_faculty:0, total_courses:0, total_assessments:0 });
          const [students, setStudents] = useState([]);
          const [loading, setLoading] = useState(false);
          const [auth, setAuth] = useState({ token:'', role:'' });

          useEffect(() => { fetchStats(); fetchStudents(); }, []);

          async function fetchStats(){
            try{
              const res = await fetch(`${API}/dashboard/stats`);
              if(res.ok){ const data = await res.json(); setStats(data); }
            }catch(e){ console.error('stats', e) }
          }

          async function fetchStudents(){
            setLoading(true);
            try{
              const res = await fetch(`${API}/students`);
              if(res.ok){ const data = await res.json(); setStudents(data); }
            }catch(e){ console.error('students', e) }
            setLoading(false);
          }

          async function doLogin(email, password){
            try{
              const res = await fetch(`${API}/login`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({ email, password }) });
              if(res.ok){ const d=await res.json(); setAuth({ token:d.token, role:d.user.role }); return true; }
              return false;
            }catch(e){ console.error('login',e); return false }
          }

          return (
            <div className="app">
              <header>
                <div>
                  <strong>Smart Exam Cell</strong>
                  <div style={{fontSize:12,opacity:.9}}>Mini dashboard (no build, runs in-browser)</div>
                </div>
                <div className="nav">
                  <button onClick={()=>setPage('dashboard')}>Dashboard</button>
                  <button onClick={()=>setPage('students')}>Students</button>
                  <button onClick={()=>setPage('tables')}>DB Tables</button>
                </div>
              </header>

              <main>
                {page === 'dashboard' && (
                  <div>
                    <div style={{display:'flex',gap:12}} className="stats">
                      <div className="stat">
                        <div style={{fontSize:12,color:'#6b7280'}}>Total Students</div>
                        <div style={{fontSize:22,fontWeight:700}}>{stats.total_students}</div>
                      </div>
                      <div className="stat">
                        <div style={{fontSize:12,color:'#6b7280'}}>Faculty</div>
                        <div style={{fontSize:22,fontWeight:700}}>{stats.total_faculty}</div>
                      </div>
                      <div className="stat">
                        <div style={{fontSize:12,color:'#6b7280'}}>Courses</div>
                        <div style={{fontSize:22,fontWeight:700}}>{stats.total_courses}</div>
                      </div>
                      <div className="stat">
                        <div style={{fontSize:12,color:'#6b7280'}}>Assessments</div>
                        <div style={{fontSize:22,fontWeight:700}}>{stats.total_assessments}</div>
                      </div>
                    </div>

                    <div className="card">
                      <h3 style={{margin:'12px 0'}}>Latest students</h3>
                      {loading ? <div>Loading...</div> : (
                        <table>
                          <thead>
                            <tr><th>ID</th><th>Name</th><th>Email</th><th>Program</th></tr>
                          </thead>
                          <tbody>
                            {students.slice(0,10).map(s => (
                              <tr key={s.student_id}><td>{s.student_id}</td><td>{s.first_name} {s.last_name}</td><td>{s.email}</td><td>{s.program_name||'N/A'}</td></tr>
                            ))}
                          </tbody>
                        </table>
                      )}
                    </div>
                  </div>
                )}

                {page === 'students' && (
                  <div>
                    <h3>Students</h3>
                    <button onClick={fetchStudents}>Refresh</button>
                    <table>
                      <thead><tr><th>ID</th><th>Name</th><th>Email</th><th>Dept</th></tr></thead>
                      <tbody>
                        {students.map(s => (
                          <tr key={s.student_id}><td>{s.student_id}</td><td>{s.first_name} {s.last_name}</td><td>{s.email}</td><td>{s.department_name||'N/A'}</td></tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                )}

                {page === 'tables' && (
                  <div>
                    <h3>Database Tables (server-rendered)</h3>
                    <p>You can open <a href="/tables">/tables</a> to view server-rendered DB tables in a simple template.</p>
                  </div>
                )}
              </main>
            </div>
          );
        }

        ReactDOM.render(<SmartExamCell />, document.getElementById('root'));
      </script>
    </body>
  </html>